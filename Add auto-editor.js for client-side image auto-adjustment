function autoAdjustImage(imgElement, callback) {
  const img = new Image();
  img.crossOrigin = 'anonymous';
  img.src = imgElement.src;
  img.onload = () => {
    const canvas = document.createElement('canvas');
    canvas.width = img.width; canvas.height = img.height;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(img,0,0);
    const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
    const data = imageData.data;
    let rmin=255,gmin=255,bmin=255,rmax=0,gmax=0,bmax=0;
    for(let i=0;i<data.length;i+=4){
      rmin=Math.min(rmin,data[i]); gmin=Math.min(gmin,data[i+1]); bmin=Math.min(bmin,data[i+2]);
      rmax=Math.max(rmax,data[i]); gmax=Math.max(gmax,data[i+1]); bmax=Math.max(bmax,data[i+2]);
    }
    const stretch = (v, min, max) => Math.max(0, Math.min(255, (v - min) * 255 / (max - min || 1)));
    for(let i=0;i<data.length;i+=4){
      data[i] = stretch(data[i], rmin, rmax);
      data[i+1] = stretch(data[i+1], gmin, gmax);
      data[i+2] = stretch(data[i+2], bmin, bmax);
    }
    ctx.putImageData(imageData,0,0);
    const outUrl = canvas.toDataURL('image/jpeg', 0.9);
    if(callback) callback(outUrl);
  };
}
